/*! sidescroller 2014-11-05 */
function renderMiniMap(){"use strict";var a=100,b=1e3,c=null,d=null,e=null,f=null;context.beginPath(),context.arc(150,150,a,0,2*Math.PI,!1),context.fillStyle="rgba(200, 200, 255, 0.3)",context.fill();for(c in entities)entities.hasOwnProperty(c)&&(d=entities[c],e=d.x/b*a+a+50,f=d.y/b*a+a+50,context.beginPath(),d.type===PLAYER_ENTITY?(context.fillStyle="rgba(0, 255, 0, 0.7)",context.arc(e,f,3,0,2*Math.PI,!1)):d.type===ASTEROID_ENTITY?(context.fillStyle="rgba(255, 0, 0, 0.7)",context.arc(e,f,3*d.scale,0,2*Math.PI,!1)):d.type===BULLET_ENTITY&&(context.fillStyle="rgba(0, 0, 255, 0.7)",context.arc(e,f,2,0,2*Math.PI,!1)),context.fill())}function render(){"use strict";var a=null,b=null,c=null,d=null,e=0,f=0,g=0;null!==cameraEntityKey&&(a=entities[cameraEntityKey],cx=parseInt(window.innerWidth/2-a.x,10),cy=parseInt(window.innerHeight/2-a.y,10)),context.clearRect(0,0,canvas.width,canvas.height);for(b in entities)entities.hasOwnProperty(b)&&(c=entities[b],context.save(),d=ship_img,g=2*c.radius,f=2*c.radius,c.type===PLAYER_ENTITY?(d=ship_img,c.ghost&&(context.globalAlpha=.5),c.alive||(context.globalAlpha=0)):c.type===SPACE_ENTITY?d=space_img:c.type===ASTEROID_ENTITY?d=asteroid_img:c.type===BULLET_ENTITY&&(d=bullet_img,f=10,g=38),context.translate(c.x+cx,c.y+cy),context.rotate(c.rotate+Math.PI/2),c.type===SPACE_ENTITY?context.drawImage(d,-c.radius,-c.radius):context.drawImage(d,-c.radius,-c.radius,f,g),context.restore());if(null!==cameraEntityKey){e=50,context.fillStyle="blue",context.font="bold 16px Arial",context.fillText("Player",canvas.width-500,20),context.fillText("Lives",canvas.width-400,20),context.fillText("Score (R)",canvas.width-300,20),context.fillText("Score (G)",canvas.width-200,20),context.fillText("Wins",canvas.width-100,20);for(b in entities)entities.hasOwnProperty(b)&&(c=entities[b],c.type===PLAYER_ENTITY&&(context.fillText(c.username,canvas.width-500,e),context.fillText(c.lives,canvas.width-400,e),context.fillText(c.round_score,canvas.width-300,e),context.fillText(c.all_time_score,canvas.width-200,e),context.fillText(c.all_time_wins,canvas.width-100,e),e+=20));context.beginPath(),context.arc(cx,cy,1e3,0,2*Math.PI,!1),context.fillStyle="rgba(255, 255, 255, 0.1)",context.fill(),a&&!a.alive&&(context.fillStyle="rgba(255, 0, 0, 0.8)",context.font="bold 30px Arial",context.fillText("You be DEAD!",canvas.width/2-100,canvas.height/2)),renderMiniMap()}}var canvas=document.getElementById("canvas"),context=canvas.getContext("2d");$(window).resize(function(){"use strict";canvas.width=window.innerWidth,canvas.height=window.innerHeight,$("#login_div").css("left",canvas.width/2-200),$("#login_div").css("top",canvas.height/2-150)}),$(window).resize();var socket=io(),BULLET_ENTITY=1,PLAYER_ENTITY=2,ASTEROID_ENTITY=3,SPACE_ENTITY=4,W=87,A=65,S=83,D=68,SPACE=32,LEFT=1,RIGHT=2,UP=4,DOWN=8,SHOOT=16,keys=0,cx=0,cy=0,cameraEntityKey=null,entities={};socket.on("id",function(a){"use strict";cameraEntityKey=a,$("#login_div").hide()}),socket.on("invalid_login",function(){"use strict";$("#message").html("Invalid login information!")}),socket.on("account_exists",function(){"use strict";$("#message").html("Account name already exists!")}),$("#login_btn").click(function(){"use strict";var a=$("#username").val(),b=$("#password").val();socket.emit("login",{username:a,password:b})}),$("#register_btn").click(function(){"use strict";var a=$("#username").val(),b=$("#password").val();socket.emit("register",{username:a,password:b})});var space_img=new Image,ship_img=new Image,asteroid_img=new Image,bullet_img=new Image;space_img.src="starfield.gif",ship_img.src="ship.png",asteroid_img.src="asteroid.png",bullet_img.src="bullet.png",socket.on("entities",function(a){"use strict";entities=a,render()}),$(window).keydown(function(a){"use strict";if(cameraEntityKey){var b=a.keyCode||a.which;return b===W?keys|=UP:b===A?keys|=LEFT:b===S?keys|=DOWN:b===D?keys|=RIGHT:b===SPACE&&(keys|=SHOOT),socket.emit("keys",keys),!1}}),$(window).keyup(function(a){"use strict";if(cameraEntityKey){var b=a.keyCode||a.which;return b===W?keys&=~UP:b===A?keys&=~LEFT:b===S?keys&=~DOWN:b===D?keys&=~RIGHT:b===SPACE&&(keys&=~SHOOT),socket.emit("keys",keys),!1}});